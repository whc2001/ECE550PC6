module game_render_controller(oPixel, iClock, iAddress);

    input [18:0] iAddress;  // 640*480 = 307200
    input iClock;
    output [23:0] oPixel;

    /** Color Mapper **/
    reg [12:0] color_cidx_in;
    color_map cm (
        .address(color_cidx_in),
        .clock(iClock),
        .q(oPixel)
    );

    /** Background Pixel Mapper **/
    reg [16:0] bg_pidx_in;
    wire [15:0] bg_cidx_out;
    bg_pixelmap bg (
        .address(bg_pidx_in),
        .clock(iClock),
        .q(bg_cidx_out)
    );

    always @(iAddress) begin
		integer x = iAddress % 640;
        integer y = iAddress / 640;

        bg_pidx_in = (x % 260) + (y * 640);

        assign color_cidx_in = bg_cidx_out;
	end

endmodule;
